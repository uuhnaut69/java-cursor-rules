<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <title>Module 4: Refactoring and Solution Implementation - Cursor Rules for Java</title>
  <meta name="author" content="" />
  <meta name="description" content="">
  <link rel="alternate" type="application/atom+xml" href="../../feed.xml" title="Cursor Rules for Java"/>

  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="../../css/bootstrap.min.css">
  <link rel="stylesheet" href="../../css/bootstrap-social.css" />
  <link rel="stylesheet" href="../../css/main.css" />

  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />

  <link rel="stylesheet" href="../../css/asciidoctor.css">
  <link rel="stylesheet" href="../../css/prettify.css">
  <link rel="shortcut icon" href="../../favicon.ico">
</head>

<body>
<nav class="navbar navbar-default navbar-fixed-top navbar-custom">
<div class="container-fluid">

<div class="navbar-header">
<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
  <span class="sr-only">Toggle navigation</span>
  <span class="icon-bar"></span>
  <span class="icon-bar"></span>
  <span class="icon-bar"></span>
</button>
<a class="navbar-brand" href="../../index.html">Cursor Rules for Java</a>
</div>

<div class="collapse navbar-collapse" id="main-navbar">
<ul class="nav navbar-nav navbar-right">
  <li class="navlinks-container">
    <a class="navlinks-parent" href="javascript:void(0)">Courses</a>
    <div class="navlinks-children">
      <a href="../../courses/system-prompts-java/index.html">System prompts for Java</a>
      <a href="../../courses/java-generics/index.html">Java Generics</a>
      <a href="../../courses/profile-memory-leak/index.html">Memory Leak Profiling</a>
    </div>
  </li>
  <li><a href="../../archive.html">Archive</a></li>
  <li><a href="../../about.html">About</a></li>
</ul>
</div>



</div>
</nav>



<header class="header-section">


<div class="intro-header no-img">
<div class="container">
<div class="row">
<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
<div class="course-heading">
<h1>Module 4: Refactoring and Solution Implementation</h1>
</div>
</div>
</div>
</div>
</div>
</header>


<div class="container">
<div class="row">
<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
<article role="main" class="course-content">

<div class="course-meta">
    <i class="fa fa-calendar-o"></i>
    2025-09-17
    &nbsp;
    <i class="fa fa-user"></i>
    MyRobot
    &nbsp;
    <i class="fa fa-tag"></i>
    Version 0.11.0-SNAPSHOT
  <div class="course-tags">
    &nbsp;
    <i class="fa fa-tags"></i>
      <a href="../../tags/java.html" class="course-tag">java</a>
      <a href="../../tags/profiling.html" class="course-tag">profiling</a>
      <a href="../../tags/memory-leak.html" class="course-tag">memory-leak</a>
      <a href="../../tags/refactoring.html" class="course-tag">refactoring</a>
      <a href="../../tags/implementation.html" class="course-tag">implementation</a>
      <a href="../../tags/validation.html" class="course-tag">validation</a>
  </div>
</div>
<hr>

<h2>Implementing Memory Leak Fixes and Validation</h2>
<p><strong>‚è±Ô∏è Duration:</strong> 2 hours<br />
<strong>üéØ Learning Objectives:</strong><br />
- Implement the prioritized solutions identified in Module 3<br />
- Understand the <code>coco=false</code> configuration pattern for immediate leak resolution<br />
- Understand proper resource lifecycle management patterns<br />
- Validate that fixes are correctly applied and effective<br />
- Set up monitoring and alerting for ongoing protection</p>
<hr />
<h2>üöÄ Implementation Strategy Overview</h2>
<h3>The Three-Phase Implementation Approach</h3>
<p>Based on your analysis from Module 3, we'll implement solutions in priority order:</p>
<ol>
<li><strong>Phase 1: Emergency Response (5 minutes)</strong> - Configuration change for immediate relief</li>
<li><strong>Phase 2: Validation and Monitoring (30 minutes)</strong> - Verify fixes and establish monitoring</li>
<li><strong>Phase 3: Long-term Improvements (1 hour)</strong> - Enhanced patterns and prevention</li>
</ol>
<h3>üí° Learning Insight</h3>
<p><strong>The beauty of the <code>coco=false</code> pattern is that it demonstrates the complete solution already implemented in <code>NoCocoController</code>. This allows you to see the &quot;after&quot; state immediately while learning the specific patterns that prevent memory leaks!</strong></p>
<hr />
<h2>‚ö° Phase 1: Emergency Response - Configuration Change</h2>
<h3><strong>üéØ Practical Exercise 1: Immediate Memory Leak Resolution</strong></h3>
<p>Let's implement the highest-priority solution with immediate impact:</p>
<h4><strong>Step 1: Verify Current Configuration</strong></h4>
<pre><code class="language-bash">cd ./cursor-rules-java/examples/spring-boot-memory-leak-demo

# Check current configuration
echo &quot;=== Current Configuration Status ===&quot;
curl -s http://localhost:8080/actuator/env/coco | grep -E '&quot;value&quot;|&quot;name&quot;'

# Verify which controller is active by testing endpoints
echo &quot;=== Testing Current Controller ===&quot;
RESPONSE=$(curl -s -X POST http://localhost:8080/api/v1/objects/create)
echo &quot;Object creation response: $RESPONSE&quot;

# Check current memory usage
echo &quot;=== Current Memory Usage ===&quot;
curl -s http://localhost:8080/actuator/metrics/jvm.memory.used | grep -E '&quot;name&quot;|&quot;value&quot;'
</code></pre>
<h4><strong>Step 2: Apply the Configuration Change</strong></h4>
<p><strong>Method 1: Runtime Configuration Override (Immediate)</strong></p>
<pre><code class="language-bash"># Stop the current application
# Press Ctrl+C in the terminal running the application

# Restart with coco=false
echo &quot;Starting application with memory leak fixes enabled...&quot;
./run-java-process-for-profiling.sh --profile vt
# This uses the application-vt.properties profile which has coco=false
</code></pre>
<p><strong>Method 2: Direct Configuration File Edit (Permanent)</strong></p>
<pre><code class="language-bash"># Edit the main configuration file
cp src/main/resources/application.properties src/main/resources/application.properties.backup

# Change the configuration
sed -i.bak 's/coco=true/coco=false/' src/main/resources/application.properties

# Verify the change
echo &quot;=== Configuration Change Applied ===&quot;
grep coco src/main/resources/application.properties

# Restart application
./run-java-process-for-profiling.sh
</code></pre>
<h4><strong>Step 3: Immediate Validation</strong></h4>
<pre><code class="language-bash"># Wait for application startup (30 seconds)
sleep 30

# Verify the configuration change took effect
echo &quot;=== Post-Change Configuration Verification ===&quot;
curl -s http://localhost:8080/actuator/env/coco

# Test that fixed controller is now active
echo &quot;=== Testing Fixed Controller ===&quot;
for i in {1..5}; do
    RESPONSE=$(curl -s -X POST http://localhost:8080/api/v1/objects/create)
    echo &quot;Test $i: $RESPONSE&quot;
done

# Verify bounds checking is working
echo &quot;=== Testing Bounds Protection ===&quot;
# The fixed controller has MAX_OBJECTS=10000, but we can test the pattern
curl -s -X POST http://localhost:8080/api/v1/objects/create | grep -E &quot;created|limit&quot;
</code></pre>
<h3><strong>üîç Understanding the Fix: Code Comparison</strong></h3>
<p>Let's examine exactly what changed:</p>
<pre><code class="language-bash"># View the problematic implementation
echo &quot;=== PROBLEMATIC IMPLEMENTATION (CocoController) ===&quot;
grep -A 10 -B 2 &quot;createObject&quot; src/main/java/info/jab/ms/CocoController.java

echo &quot;&quot;
echo &quot;=== FIXED IMPLEMENTATION (NoCocoController) ===&quot;
grep -A 15 -B 2 &quot;createObject&quot; src/main/java/info/jab/ms/NoCocoController.java
</code></pre>
<p><strong>Key Differences Analysis:</strong></p>
<p><strong>Collection Bounds:</strong><br />
- CocoController (Problematic): <code>objects.add(new MyPojo(...))</code><br />
- NoCocoController (Fixed): <code>if (objects.size() &gt;= MAX_OBJECTS)</code> bounds check<br />
<strong>Error Handling:</strong><br />
- CocoController (Problematic): No bounds validation<br />
- NoCocoController (Fixed): Returns <code>400 Bad Request</code> when limit reached<br />
<strong>Thread Management:</strong><br />
- CocoController (Problematic): <code>Executors.newFixedThreadPool(5)</code> per request<br />
- NoCocoController (Fixed): Shared <code>ExecutorService</code> with lifecycle<br />
<strong>Resource Cleanup:</strong><br />
- CocoController (Problematic): No cleanup logic<br />
- NoCocoController (Fixed): <code>@PreDestroy</code> method with proper shutdown<br />
<strong>Thread Safety:</strong><br />
- CocoController (Problematic): Basic <code>ArrayList</code><br />
- NoCocoController (Fixed): <code>Collections.synchronizedList</code></p>
<h3>üí° Learning Reinforcement</h3>
<p><strong>Notice how the fixed implementation follows enterprise patterns: bounded collections, shared resources, lifecycle management, and graceful error handling. These aren't just memory leak fixes - they're production-ready design patterns!</strong></p>
<hr />
<h2>üîç Phase 2: Validation and Monitoring</h2>
<h3><strong>üéØ Practical Exercise 2: Comprehensive Fix Validation</strong></h3>
<h4><strong>Step 1: Functional Validation</strong></h4>
<pre><code class="language-bash"># Create comprehensive validation script
cat &gt; validate-fixes.sh &lt;&lt; 'EOF'
#!/bin/bash
echo &quot;=== MEMORY LEAK FIX VALIDATION ===&quot;
echo &quot;Timestamp: $(date)&quot;
echo &quot;&quot;

# Test 1: Configuration verification
echo &quot;1. Configuration Status:&quot;
CONFIG_RESPONSE=$(curl -s http://localhost:8080/actuator/env/coco)
echo &quot;$CONFIG_RESPONSE&quot; | grep -E '&quot;value&quot;|&quot;name&quot;' | head -2

# Test 2: Bounds checking validation
echo &quot;&quot;
echo &quot;2. Bounds Checking Test:&quot;
for i in {1..10}; do
    RESPONSE=$(curl -s -X POST http://localhost:8080/api/v1/objects/create)
    echo &quot;  Request $i: $RESPONSE&quot;
done

# Test 3: Thread creation test
echo &quot;&quot;
echo &quot;3. Thread Management Test:&quot;
for i in {1..5}; do
    THREAD_RESPONSE=$(curl -s -X POST http://localhost:8080/api/v1/threads/create)
    echo &quot;  Thread test $i: $THREAD_RESPONSE&quot;
done

# Test 4: Memory usage baseline
echo &quot;&quot;
echo &quot;4. Memory Usage Check:&quot;
MEMORY_USED=$(curl -s http://localhost:8080/actuator/metrics/jvm.memory.used)
echo &quot;$MEMORY_USED&quot; | grep -E '&quot;value&quot;' | head -1

# Test 5: Application health
echo &quot;&quot;
echo &quot;5. Application Health:&quot;
HEALTH=$(curl -s http://localhost:8080/actuator/health)
echo &quot;$HEALTH&quot;

echo &quot;&quot;
echo &quot;=== VALIDATION COMPLETE ===&quot;
EOF
chmod +x validate-fixes.sh

# Run validation
./validate-fixes.sh
</code></pre>
<h4><strong>Step 2: Load Testing Validation</strong></h4>
<pre><code class="language-bash"># Run sustained load test to verify stability
echo &quot;=== SUSTAINED LOAD TEST ===&quot;
echo &quot;Running 10-minute stability test...&quot;

# Start JMeter load test
./run-jmeter.sh -t 600 -c 3 -e both &amp;
JMETER_PID=$!

# Monitor memory usage during load test
echo &quot;Monitoring memory usage every 30 seconds...&quot;
for i in {1..20}; do
    TIMESTAMP=$(date '+%H:%M:%S')
    MEMORY=$(curl -s http://localhost:8080/actuator/metrics/jvm.memory.used | grep -o '&quot;value&quot;:[0-9]*' | grep -o '[0-9]*')
    echo &quot;$TIMESTAMP: Memory used: $MEMORY bytes&quot;
    sleep 30
done

# Wait for JMeter to complete
wait $JMETER_PID
echo &quot;Load test completed successfully&quot;
</code></pre>
<h4><strong>Step 3: Comparative Memory Analysis</strong></h4>
<pre><code class="language-bash"># Generate post-fix profiling data for comparison
echo &quot;=== GENERATING POST-FIX PROFILING DATA ===&quot;

cd profiler/scripts
./profile-java-process.sh
# Select: 2. Memory Allocation Profiling (30s)
# This will generate new flamegraphs with the fixes applied

# Generate load during profiling
cd ../..
for i in {1..50}; do
    curl -s -X POST http://localhost:8080/api/v1/objects/create &gt; /dev/null
    curl -s -X POST http://localhost:8080/api/v1/threads/create &gt; /dev/null
    sleep 1
done

echo &quot;Post-fix profiling data generated&quot;
</code></pre>
<hr />
<h2>üõ†Ô∏è Phase 3: Understanding the Implementation Patterns</h2>
<h3><strong>Resource Lifecycle Management Deep Dive</strong></h3>
<p>Let's examine the specific patterns that prevent memory leaks:</p>
<h4><strong>üéØ Practical Exercise 3: Code Pattern Analysis</strong></h4>
<pre><code class="language-bash"># Extract and analyze the key patterns
echo &quot;=== RESOURCE LIFECYCLE PATTERNS ===&quot;

# Pattern 1: Bounded Collections
echo &quot;1. Bounded Collection Pattern:&quot;
grep -A 5 -B 2 &quot;MAX_OBJECTS&quot; src/main/java/info/jab/ms/NoCocoController.java

echo &quot;&quot;
echo &quot;2. Thread Pool Management Pattern:&quot;
grep -A 10 -B 2 &quot;sharedExecutorService&quot; src/main/java/info/jab/ms/NoCocoController.java

echo &quot;&quot;
echo &quot;3. Resource Cleanup Pattern:&quot;
grep -A 10 -B 2 &quot;@PreDestroy&quot; src/main/java/info/jab/ms/NoCocoController.java
</code></pre>
<h4><strong>Understanding Each Pattern</strong></h4>
<p><strong>1. Bounded Collections Pattern:</strong></p>
<pre><code class="language-java">private static final int MAX_OBJECTS = 10000;
private final List&lt;MyPojo&gt; objects = Collections.synchronizedList(new ArrayList&lt;&gt;());

@PostMapping(&quot;/objects/create&quot;)
public ResponseEntity&lt;String&gt; createObject() {
    if (objects.size() &gt;= MAX_OBJECTS) {
        return ResponseEntity.badRequest()
            .body(&quot;Maximum objects limit reached: &quot; + MAX_OBJECTS);
    }
    objects.add(new MyPojo(UUID.randomUUID().toString(),
                          &quot;A&quot;.repeat(1000),
                          System.currentTimeMillis()));
    return ResponseEntity.ok(&quot;Object created: &quot; + objects.size());
}
</code></pre>
<p><strong>Key Benefits:</strong><br />
- ‚úÖ <strong>Memory Protection</strong>: Prevents unbounded growth<br />
- ‚úÖ <strong>Graceful Degradation</strong>: Returns meaningful error instead of crashing<br />
- ‚úÖ <strong>Thread Safety</strong>: Uses synchronized wrapper for concurrent access<br />
- ‚úÖ <strong>Monitoring</strong>: Provides current count for observability</p>
<p><strong>2. Shared Thread Pool Pattern:</strong></p>
<pre><code class="language-java">private final ExecutorService sharedExecutorService =
    Executors.newFixedThreadPool(10, new CustomizableThreadFactory(&quot;shared-pool-&quot;));

@PostMapping(&quot;/threads/create&quot;)
public ResponseEntity&lt;String&gt; createThread() {
    sharedExecutorService.submit(() -&gt; {
        try {
            Thread.sleep(1000);
            log.info(&quot;Task executed in thread: {}&quot;, Thread.currentThread().getName());
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
    });
    return ResponseEntity.ok(&quot;Task submitted to shared thread pool&quot;);
}
</code></pre>
<p><strong>Key Benefits:</strong><br />
- ‚úÖ <strong>Resource Efficiency</strong>: Single shared pool vs. multiple pools<br />
- ‚úÖ <strong>Lifecycle Management</strong>: Proper initialization and cleanup<br />
- ‚úÖ <strong>Named Threads</strong>: CustomizableThreadFactory for debugging<br />
- ‚úÖ <strong>Interruption Handling</strong>: Proper interrupt signal management</p>
<p><strong>3. Resource Cleanup Pattern:</strong></p>
<pre><code class="language-java">@PreDestroy
public void cleanup() throws InterruptedException {
    log.info(&quot;Shutting down shared executor service...&quot;);
    sharedExecutorService.shutdown();

    if (!sharedExecutorService.awaitTermination(30, TimeUnit.SECONDS)) {
        log.warn(&quot;Executor did not terminate gracefully, forcing shutdown...&quot;);
        sharedExecutorService.shutdownNow();

        if (!sharedExecutorService.awaitTermination(10, TimeUnit.SECONDS)) {
            log.error(&quot;Executor did not terminate after forced shutdown&quot;);
        }
    }
    log.info(&quot;Shared executor service shutdown complete&quot;);
}
</code></pre>
<p><strong>Key Benefits:</strong><br />
- ‚úÖ <strong>Graceful Shutdown</strong>: Allows running tasks to complete<br />
- ‚úÖ <strong>Timeout Protection</strong>: Forces shutdown if graceful fails<br />
- ‚úÖ <strong>Logging</strong>: Provides visibility into shutdown process<br />
- ‚úÖ <strong>Resource Guarantee</strong>: Ensures threads are properly cleaned up</p>
<h3>üí° Learning Reinforcement</h3>
<p><strong>These patterns represent enterprise-grade resource management. The <code>@PreDestroy</code> pattern is especially important - it's Spring's way of ensuring cleanup happens during application shutdown, preventing resource leaks even during deployment cycles!</strong></p>
<hr />
<h2>üìä Monitoring and Alerting Setup</h2>
<h3><strong>üéØ Practical Exercise 4: Implementing Memory Monitoring</strong></h3>
<h4><strong>Step 1: JVM Monitoring Configuration</strong></h4>
<pre><code class="language-bash"># Add comprehensive JVM monitoring flags
cat &gt; monitoring-flags.txt &lt;&lt; 'EOF'
# Memory Monitoring JVM Flags
-XX:+PrintGC
-XX:+PrintGCDetails
-XX:+PrintGCTimeStamps
-XX:+PrintGCApplicationStoppedTime
-Xloggc:gc-monitoring.log
-XX:+UseGCLogFileRotation
-XX:NumberOfGCLogFiles=5
-XX:GCLogFileSize=10M

# Memory Dump on OutOfMemoryError
-XX:+HeapDumpOnOutOfMemoryError
-XX:HeapDumpPath=./memory-dumps/

# JFR Continuous Profiling
-XX:+FlightRecorder
-XX:StartFlightRecording=duration=1h,filename=continuous-monitoring.jfr,settings=profile
EOF

echo &quot;Monitoring configuration created. Add these flags to your startup script.&quot;
</code></pre>
<h4><strong>Step 2: Application Metrics Monitoring</strong></h4>
<pre><code class="language-bash"># Create memory monitoring script
cat &gt; monitor-memory.sh &lt;&lt; 'EOF'
#!/bin/bash
MONITOR_DURATION=${1:-300}  # Default 5 minutes
INTERVAL=${2:-10}           # Default 10 seconds

echo &quot;=== MEMORY MONITORING ===&quot;
echo &quot;Duration: $MONITOR_DURATION seconds&quot;
echo &quot;Interval: $INTERVAL seconds&quot;
echo &quot;Timestamp,HeapUsed,HeapMax,NonHeapUsed,ObjectCount&quot; &gt; memory-monitor.csv

START_TIME=$(date +%s)
END_TIME=$((START_TIME + MONITOR_DURATION))

while [ $(date +%s) -lt $END_TIME ]; do
    TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')

    # Get heap memory usage
    HEAP_USED=$(curl -s http://localhost:8080/actuator/metrics/jvm.memory.used?tag=area:heap | grep -o '&quot;value&quot;:[0-9]*' | grep -o '[0-9]*')
    HEAP_MAX=$(curl -s http://localhost:8080/actuator/metrics/jvm.memory.max?tag=area:heap | grep -o '&quot;value&quot;:[0-9]*' | grep -o '[0-9]*')

    # Get non-heap memory usage
    NONHEAP_USED=$(curl -s http://localhost:8080/actuator/metrics/jvm.memory.used?tag=area:nonheap | grep -o '&quot;value&quot;:[0-9]*' | grep -o '[0-9]*')

    # Get object count from our controller
    OBJECT_RESPONSE=$(curl -s -X POST http://localhost:8080/api/v1/objects/create)
    OBJECT_COUNT=$(echo &quot;$OBJECT_RESPONSE&quot; | grep -o '[0-9]*$' || echo &quot;0&quot;)

    # Log to CSV
    echo &quot;$TIMESTAMP,$HEAP_USED,$HEAP_MAX,$NONHEAP_USED,$OBJECT_COUNT&quot; &gt;&gt; memory-monitor.csv

    # Display current status
    HEAP_PCT=$((HEAP_USED * 100 / HEAP_MAX))
    echo &quot;[$TIMESTAMP] Heap: ${HEAP_PCT}% ($HEAP_USED/$HEAP_MAX bytes), Objects: $OBJECT_COUNT&quot;

    sleep $INTERVAL
done

echo &quot;Monitoring complete. Data saved to memory-monitor.csv&quot;
EOF
chmod +x monitor-memory.sh

# Run monitoring during load test
echo &quot;Starting memory monitoring with load test...&quot;
./monitor-memory.sh 300 15 &amp;  # 5 minutes, 15-second intervals
MONITOR_PID=$!

# Generate load during monitoring
for i in {1..100}; do
    curl -s -X POST http://localhost:8080/api/v1/objects/create &gt; /dev/null
    sleep 3
done

wait $MONITOR_PID
echo &quot;Memory monitoring completed&quot;
</code></pre>
<h4><strong>Step 3: Alerting Thresholds</strong></h4>
<pre><code class="language-bash"># Create alerting configuration
cat &gt; memory-alerts.sh &lt;&lt; 'EOF'
#!/bin/bash
# Memory alerting script

HEAP_THRESHOLD=80  # Alert when heap usage &gt; 80%
OBJECT_THRESHOLD=9000  # Alert when objects &gt; 9000

check_memory_usage() {
    HEAP_USED=$(curl -s http://localhost:8080/actuator/metrics/jvm.memory.used?tag=area:heap | grep -o '&quot;value&quot;:[0-9]*' | grep -o '[0-9]*')
    HEAP_MAX=$(curl -s http://localhost:8080/actuator/metrics/jvm.memory.max?tag=area:heap | grep -o '&quot;value&quot;:[0-9]*' | grep -o '[0-9]*')

    if [ -n &quot;$HEAP_USED&quot; ] &amp;&amp; [ -n &quot;$HEAP_MAX&quot; ]; then
        HEAP_PCT=$((HEAP_USED * 100 / HEAP_MAX))

        if [ $HEAP_PCT -gt $HEAP_THRESHOLD ]; then
            echo &quot;ALERT: Heap usage at ${HEAP_PCT}% (threshold: ${HEAP_THRESHOLD}%)&quot;
            return 1
        fi
    fi

    return 0
}

check_object_count() {
    OBJECT_RESPONSE=$(curl -s -X POST http://localhost:8080/api/v1/objects/create)
    OBJECT_COUNT=$(echo &quot;$OBJECT_RESPONSE&quot; | grep -o '[0-9]*$' || echo &quot;0&quot;)

    if [ &quot;$OBJECT_COUNT&quot; -gt $OBJECT_THRESHOLD ]; then
        echo &quot;ALERT: Object count at $OBJECT_COUNT (threshold: $OBJECT_THRESHOLD)&quot;
        return 1
    fi

    return 0
}

# Run checks
echo &quot;=== MEMORY ALERT CHECK ===&quot;
ALERTS=0

if ! check_memory_usage; then
    ALERTS=$((ALERTS + 1))
fi

if ! check_object_count; then
    ALERTS=$((ALERTS + 1))
fi

if [ $ALERTS -eq 0 ]; then
    echo &quot;‚úÖ All memory metrics within normal ranges&quot;
else
    echo &quot;‚ö†Ô∏è  $ALERTS alert(s) triggered&quot;
fi

exit $ALERTS
EOF
chmod +x memory-alerts.sh

# Test alerting
./memory-alerts.sh
</code></pre>
<hr />
<h2>üéØ Module 4 Assessment</h2>
<h3>Implementation Validation Checklist</h3>
<p><strong>‚úÖ Emergency Response Completed:</strong><br />
- [ ] Successfully changed configuration to <code>coco=false</code><br />
- [ ] Verified <code>NoCocoController</code> is now active<br />
- [ ] Confirmed bounds checking is working (MAX_OBJECTS limit)<br />
- [ ] Validated thread pool management is operational<br />
- [ ] Application remains stable and responsive</p>
<p><strong>‚úÖ Code Pattern Understanding:</strong><br />
- [ ] Identified bounded collection implementation<br />
- [ ] Understood shared thread pool lifecycle management<br />
- [ ] Recognized <code>@PreDestroy</code> cleanup pattern<br />
- [ ] Analyzed thread safety improvements<br />
- [ ] Documented key differences between implementations</p>
<p><strong>‚úÖ Monitoring and Validation:</strong><br />
- [ ] Generated post-fix profiling data<br />
- [ ] Completed sustained load testing (10+ minutes)<br />
- [ ] Implemented memory usage monitoring<br />
- [ ] Created alerting thresholds and scripts<br />
- [ ] Documented baseline metrics for comparison</p>
<p><strong>‚úÖ Production Readiness:</strong><br />
- [ ] Validated fixes under realistic load conditions<br />
- [ ] Established ongoing monitoring capabilities<br />
- [ ] Created alerting for early problem detection<br />
- [ ] Documented implementation for team knowledge transfer</p>
<h3>üéØ Advanced Challenge: Custom Resource Management Pattern</h3>
<p><strong>Challenge:</strong> Implement your own resource management pattern following the principles learned</p>
<p><strong>Scenario:</strong> Create a custom cache implementation that prevents memory leaks</p>
<p><strong>Requirements:</strong></p>
<pre><code class="language-java">// Implement this interface following NoCocoController patterns
public class SafeCache&lt;K, V&gt; {
    private static final int MAX_CACHE_SIZE = 1000;
    private final Map&lt;K, V&gt; cache = /* your implementation */;

    // TODO: Implement bounded put method
    public V put(K key, V value) {
        // Your bounds-checking implementation
    }

    // TODO: Implement cleanup method
    @PreDestroy
    public void cleanup() {
        // Your resource cleanup implementation
    }
}
</code></pre>
<p><strong>Success Criteria:</strong><br />
- [ ] Implements bounds checking to prevent unbounded growth<br />
- [ ] Provides graceful handling when limits are reached<br />
- [ ] Includes proper cleanup lifecycle management<br />
- [ ] Thread-safe for concurrent access<br />
- [ ] Includes monitoring/observability features</p>
<hr />
<h2>üöÄ Transition to Module 5</h2>
<p><strong>Fantastic implementation work!</strong> You've successfully:<br />
- ‚úÖ Applied the immediate configuration fix to eliminate memory leaks<br />
- ‚úÖ Understood and analyzed the resource management patterns<br />
- ‚úÖ Validated fixes through comprehensive testing<br />
- ‚úÖ Implemented monitoring and alerting infrastructure<br />
- ‚úÖ Demonstrated production-ready resource lifecycle management</p>
<h3><strong>What's Next?</strong></h3>
<p>In <strong>Module 5: Validation and Comparison</strong>, we'll focus on:<br />
- Using @164-java-profiling-compare to rigorously validate improvements<br />
- Generating before/after profiling comparisons<br />
- Creating quantitative evidence of memory leak resolution<br />
- Documenting the complete success story with measurable results</p>
<h3>üí° Key Takeaway</h3>
<p><strong>&quot;The best fixes are not just functional - they're observable, maintainable, and educational. By understanding the patterns in NoCocoController, you've learned enterprise-grade resource management that applies far beyond this demo!&quot;</strong></p>
<p><strong>Ready to prove your fixes work with rigorous before/after analysis? <a href="module-5-validation.html">Let's complete the journey in Module 5!</a> üìä</strong></p>


</article>
</div>
</div>
</div>

<footer>
<div class="container beautiful-jekyll-footer">
<div class="row">
<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
<ul class="list-inline text-center footer-links">
    <li>
    <a href="https://twitter.com/juanantoniobm" title="Twitter">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  <li>
    <a href="https://github.com/jabrena/cursor-rules-java" title="GitHub">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
  <li>
    <a href="../../feed.xml" title="RSS">
      <span class="fa-stack fa-lg">
        <i class="fa fa-circle fa-stack-2x"></i>
        <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
      </span>
    </a>
  </li>
</ul>
<p class="copyright text-muted">
&copy; Juan Antonio Bre√±a Moral, 2025 |
Baked with <a href="http://jbake.org">JBake v2.7.0</a>
</p>
<p class="theme-by text-muted">
  Theme by <a href="https://github.com/Yamane/beautiful-jbake/" target="_blank">beautiful-jbake</a>
  adapted from <a href="http://deanattali.com/beautiful-jekyll/" target="_blank">beautiful-jekyll</a>
</p>
</div>
</div>
</div>
</footer>

<script src="../../js/jquery-1.11.2.min.js"></script>
<script src="../../js/bootstrap.min.js"></script>
<script src="../../js/prettify.js"></script>
<script src="../../js/run_prettify.js"></script>
<script src="../../js/main.js"></script>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-13CV90H4J4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-13CV90H4J4');
</script>

</body>
</html>
